<apex:page showHeader="false" sidebar="false"  title="Appointment Screen" standardStylesheets="false" docType="html-5.0">
<apex:remoteObjects >
    <apex:remoteObjectModel name="OpportunityContactRole" jsShorthand="getActs" fields="Id">
    <apex:remoteObjectField name="OpportunityId" jsShorthand="offerOpp"/>
    <apex:remoteObjectField name="ContactId" jsShorthand="offerCon"/>
    </apex:remoteObjectModel>
    </apex:remoteObjects>
    <apex:remoteObjects >
    <apex:remoteObjectModel name="Opportunity" jsShorthand="getUser" fields="Name">
    <apex:remoteObjectField name="Id" jsShorthand="offerOppId"/>
    <apex:remoteObjectField name="OwnerId" jsShorthand="offerOwner"/>
    </apex:remoteObjectModel>
    <apex:remoteObjectModel name="Contact" jsShorthand="getCon" fields="Name">
    <apex:remoteObjectField name="Id" jsShorthand="offerConId"/>
    <apex:remoteObjectField name="Email" jsShorthand="offeremail"/>
    <apex:remoteObjectField name="LastName" jsShorthand="offerlname"/>
    <apex:remoteObjectField name="FirstName" jsShorthand="offerfname"/>
    <apex:remoteObjectField name="Phone" jsShorthand="offerphone"/>
    </apex:remoteObjectModel>
    </apex:remoteObjects>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <apex:stylesheet value="{!URLFOR($Resource.BKSL2__BookingWidget, 'css/jquery-ui.min.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.BKSL2__BookingWidget, 'BookingScreen/css/bootstrap.min.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.BKSL2__BookingWidget, 'BookingScreen/css/bootstrap-formhelpers.min.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.BKSL2__BookingWidget, 'BookingScreen/css/font-awesome.min.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.BKSL2__BookingWidget, 'BookingScreen/css/screen.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.BKSL2__BookingWidget, 'BookingScreen/css/style.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.BKSL2__BookingWidget, 'BookingScreen/css/responsive.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.BKSL2__BookingWidget, 'BookingScreen/css/responsive.css')}"/>

<apex:includeScript value="https://maps.googleapis.com/maps/api/js?sensor=false"/>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/js.lib/jquery-1.6.2.min.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/js.lib/ui/jquery.ui.core.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/js.lib/ui/jquery.ui.widget.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/js.lib/ui/jquery.ui.datepicker.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/js.lib/jquery.inherit-1.3.2.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/js.lib/BSL_Ajax.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/js.lib/bksl.min.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/js.lib/json2.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/js.lib/jquery.tmpl.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/js.lib/spine.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/js.lib/spine.model.local.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/BookingScreen/app/models/booking.js')}"/>
<!--<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/BookingScreen/app/application.js')}"/>-->
<apex:includeScript value="{!URLFOR($Resource.BKSL_Temporary, 'BKSL_Temporary/BookingScreen/app/application.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/js.lib/livevalidation_standalone.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/BookingScreen/js/utils.js')}"/>
<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'/>
<style>
select option[disabled]{color:red;}
body{
    background-repeat:repeat !important;
}
@font-face {
     font-family: ConfigFont;
     src: url({!URLFOR($Resource.BKSL2__BookingWidget, 'fonts/OpenSans-Regular.ttf')});
 }
h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
    font-family: ConfigFont;
}
#brandheader, .fullheader{
    width: 100%;
}
.headerService{
    padding: 4px 15px;
    background-color: #428bca;
    border-color: #357ebd;
    color: #FFF;
}
.btn{
    border-radius: 0px;
}
.mainpanel{
    background:white;
    width:100% !important;
    float:left;
}
.showServiceDetails{
-webkit-padding-start: 0px;
}
.service {
    /*background-color: #d9edf7;*/
    /*border: 1px solid #bce8f1;
    -moz-border-radius: 5px;
    -o-border-radius: 5px;
    -webkit-border-radius: 5px;
    border-radius: 5px;*/
    padding:0px;
}
.showServiceDetails li {
list-style: none;
}
/*#bookingscreen1 input[type="text"]:hover , .selectoption:hover{
border: 1px solid #FBCB09;
}*/

/*#bookingscreen1 input[type="text"], .selectoption {
font-size: 16px;
font-family: inherit;
line-height: 1.4em;
border: 0;
outline: none;
padding: 4px;
border: 1px solid #999999;
-moz-border-radius: 5px;
-o-border-radius: 5px;
-webkit-border-radius: 5px;
border-radius: 5px;
-moz-box-shadow: rgba(0, 0, 0, 0.2) 0 1px 2px 0 inset;
-webkit-box-shadow: rgba(0, 0, 0, 0.2) 0 1px 2px 0 inset;
-o-box-shadow: rgba(0, 0, 0, 0.2) 0 1px 2px 0 inset;
box-shadow: rgba(0, 0, 0, 0.2) 0 1px 2px 0 inset;
}
*/

.LV_invalid_field{
        border-color: red !important;
}
#existingContact{
    background: #E37B2F;
    padding: 5px;
    text-align: right;
    font-size: 12px;
    border-bottom: 2px solid #D14836;
}
#userReference{
    font-weight:bold;
}
body{
   /* background:url('{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/images/bg2.png')}');*/
   background:#F0F0F0;
}

ul, li{
    margin:0px !important;
}

.leftPanel{
    /*padding: 0px 20px 10px 20px;*/
    padding: 15px;
    min-height:420px;
    /*width:65% !important;
    float:left;*/
}

.right-sidebar{
    /*padding: 10px 10px 0px 0px;*/
    padding: 15px;
    /*width:30% !important;
    float:left;*/
}

h1, h2, h3, h4, h5, h6 {
    display: block !important;
}

legend {
    margin: 10px 0px !important;
    border-bottom: none !important;
}

*html .popup_block {
    position: absolute;
}
.description{
    font-size: 12px;
}
.reduce_padding{
    padding-right: 10px;
    padding-left: 10px;
    line-height:2.5;
}
.reduce_margin{
    margin-right: -10px;
    margin-left: -10px;
}
#fade { /*--Transparent background layer--*/
    display: none; /*--hidden by default--*/
    background: #666;
    position: fixed; left: 0; top: 0;
    width: 100%; height: 100%;
    opacity: .50;
    z-index: 9999;
}
.SelectBookingTemplate{
    padding: 5px 15px;
}
.popup_block{
    display: none; /*--hidden by default--*/
    background: #fff;
    padding: 10px;
    border: 1px solid #a6a5a5;
    float: left;
    font-family:Arial, Helvetica, sans-serif;
    font-size: 12px;
    position: fixed;
    top: 50%; left: 50%;
    z-index: 99999;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
}
.col-lg-8{
    padding:0px;
}
.img-mid{
margin-left: auto;margin-right: auto;
}
span.LV_validation_message.LV_invalid {
  font-size: 12px;
  color:red;
}
.mainpanel{
margin-right:0px;
margin-left:0px;
}
.actionBlock{
    border-radius:0px;
}
.contactInformationBlock{
    padding: 25px;
}
.add_margin {
padding: 0px 20px;
}
.control-label{
    font-weight:normal;
}
#fieldSet1{
    padding: 20px 0px;
}
.serviceAction{
     background: #d9edf7;
     border-color: #bce8f1;
     padding: 10px 0px;
}

header {
  background-color: #FFFFFF;
  color: #7f8182;
  padding: 10px;
  border-bottom: solid 1px #d3d2d3;
}
.button {
  background: #ff7400;
  -webkit-border-radius: 4;
  -moz-border-radius: 4;
  border-radius: 4px;
  font-family: Arial;
  color: #ffffff;
  font-size: 16px;
  text-align: center;
  padding: 10px 10px 10px 10px;
  text-decoration: none;
  margin-left: 0!important;
  margin-top: 5px;
  border-color: #ff7400;
  cursor:pointer
}
.btn-primary:hover{
    background: #ff7400 !important;
    border-color: #ff7400;
}
#selectedServicePanel{
    font-family: 'open_sansregular', Arial, Helvetica, sans-serif;
  margin: 30px auto;
  font-size: 16px;
}
.button1.disabled {
  opacity: 0.65; 
  cursor: not-allowed;
}
</style>
<script>
var __sfdcSessionId = '{!GETSESSIONID()}';
var sr = new SOAPRequest({orgNameSpace: "BKSL2", sessionId : __sfdcSessionId, endPointName: "SETUP_Organization_WS"});
</script>

<script src="/soap/ajax/15.0/connection.js" type="text/javascript"></script>
<script src="/soap/ajax/15.0/apex.js" type="text/javascript"></script>
<div id="fb-root"></div>
<script>
    var bkslfb = new Object();
    bkslfb.appId = '{!JSENCODE($CurrentPage.parameters.apedi)}';
    bkslfb.user = null;
    // Additional JS functions here
    window.fbAsyncInit = function() {
        if(bkslfb.appId != null && bkslfb.appId != ''){
            FB.init({
                appId      : bkslfb.appId, // App ID
                channelUrl : '//WWW.YOUR_DOMAIN.COM/channel.html', // Channel File
                status     : true, // check login status
                cookie     : true, // enable cookies to allow the server to access the session
                xfbml      : true  // parse XFBML
            });
    
            // Additional init code here
            FB.getLoginStatus(function(response) {
                if (response.status === 'connected') {
                    // connected
                    //$('#facebookicon').hide();
                    //User is an existing user
                    getContactInformation();
                    $('#userReference1').html($('#contactFirtsName').val());
                    $('#existingContact').show();
                } else if (response.status === 'not_authorized') {
                    // not_authorized
                    $('#facebookicon').show();
                } else {
                    // not_logged_in
                    $('#facebookicon').show();
                }
            });

            function getContactInformation() {
                console.log('Welcome!  Fetching your information.... ');
                FB.api('/me', function(response) {
                    bkslfb.user = response;
                    $('#contactFirtsName').val(response.first_name);
                    $('#contactLastName').val(response.last_name);
                    $('#contactEmail').val(response.email);
                    $('#contactInfo').show();
                });
            }
        }
    
    function login(){
        FB.login(function(response) {
            // handle the response
            getContactInformation();
        }, {scope: 'email'});
    }
    if(bkslfb.appId != null && bkslfb.appId != '')
        window.fblogin = login;
    };

    // Load the SDK Asynchronously
    (function(d){
        if(bkslfb.appId != null && bkslfb.appId != ''){
            var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement('script'); js.id = id; js.async = true;
            js.src = "//connect.facebook.net/en_US/all.js";
            ref.parentNode.insertBefore(js, ref);
        }
    }(document));
   
   
    function populateSelect(target, reqId){
        if (!target){
            return false;
        }
        else {
            var response = sforce.connection.query("Select Id, BKSL2__Package__c from BKSL2__Service__c where  Id = '" + reqId + "'");
            if(response && response.records.BKSL2__Package__c && response.records.BKSL2__Package__c != null){
                var selectOptions = (response.records.BKSL2__Package__c).split(";");
                var select = document.getElementById(target);
                select.length = 0;
        
                for (var i = 0; i<selectOptions.length; i++){
                    var opt = document.createElement('option');
                    opt.value = selectOptions[i];
                    opt.innerHTML = selectOptions[i];
                    select.appendChild(opt);
                }
            }
        }
    }
</script>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/BookingScreen/js/bookingscreen.js')}"/>
    <script type="text/x-jquery-tmpl" id="selectLocationTemplate">
        <option value="${locationId}">${locationName}</option>
    </script>
    
    <script type="text/x-jquery-tmpl" id="ShowServiceTemplate">
        <div class="service row" onclick="setService('${serviceId}', '${serviceName}', '${duration}')">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 appt-type"><div class="col-xs-12 col-sm-8 col-md-8 col-lg-8"><h3>${serviceName}</h3></div><div class="col-xs-12 col-sm-4 col-md-4 col-lg-4" id="selectService"><div class="button">Schedule Now</div></div></div>
        </div>
    </script>
  
    <script type="text/x-jquery-tmpl" id="SelectBookingTemplate">
        <div class="SelectBookingTemplate">
        <!-- <div class="row">
                <div class="col-md-12">${serviceName}</div>
                <div class="col-md-7" style="margin-left: 0px;"><img src="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/images/time_small.png')}" class="img-responsive img-rounded img-mid">${duration}</div>
                <div class="col-md-4">
                    <div type="button" class="btn btn-link closeService change">Change</div>
                </div>
                <div class="col-md-12" style="margin: 0px;padding: 5px;">${description}</div>
            </div>-->
        </div>
            
        You Chose ${serviceName} 
        <div id ="bkslServiceId" type="button" class="btn btn-xs btn-link closeService change" style="font-style: italic; color: #1579ab;font-family: 'open_sansbold', Arial, Helvetica, sans-serif;">
            <span style="text-decoration: underline;  font-size: 16px;">Change</span>
        </div>
    </script>
  
    <script type="text/x-jquery-tmpl" id="BookedInformation">
        <div class="BookedInformation left-content" >
            <div class="row">
                <div class="alert alert-success" role="alert">
                    <center><span>${SuccessInfo}</span></center>
                    <center><span style="color:red;">${FailureInfo}</span></center>
                </div>
                <h2 class="thankyou-heading">Your Appointment Details:</h2> 
                <div class="appt-type" style="height: 136px;padding: 10px 30px 10px 30px;">
                    <h6>Confirmation Number:<b>${serviceRequestId}</b></h6>
                    <h6>Service:<b>${serviceName}</b></h6>
                    <h6>Scheduled Date:<b>${selectedDate}</b></h6>
                    <h6>Scheduled Time:<b> ${slotTime} &nbsp;ET (GMT - 4)</b></h6>
                </div>
                <div class="col-md-12"style="margin-left: 0px;">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 poweredby">
                        <p>We've sent a confirmation email to your inbox. Remember to save this information to your calendar.</p>
                        <p ><img src="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/images/bookingsocial_24_24.png')}" />
                        Powered by Booking Social</p>
                    </div>
                </div>
            </div>
        </div>
    </script>
    
    <script type="text/x-jquery-tmpl" id="CancelledInformation">
        <div class="BookedInformation" style="padding:20px 0px">
            <div class="row">
                <div class="col-md-12">Your appointment has been cancelled for <b>${serviceRequestId}</b></div>
                <div class="col-md-12 bold" style="margin-left: 0px;">Service: ${serviceName}</b></div>
                <div class="col-md-12" style="margin-left: 0px;">${description}</div>
                <div class="col-md-12"style="margin-left: 0px;">
                    <!--<div type="button" class="btn btn-primary" onclick="bookOneMoreAppointment()">Book Another Appointment</div>-->
                </div>
            </div>
        </div>
    </script>
    <script>
        var TAG = new Object();
        TAG.TAG001 = 'Select location';
        TAG.TAG002 = 'Select service';
        TAG.TAG003 = 'Schedule appointment';
        TAG.TAG004 = 'Your booked information';
        TAG.TAG005 = 'Please select a date';
        //TAG.TAG006 = 'Please select some other date';
        TAG.TAG006 = 'Slots not available';
        TAG.TAG007 = 'Booking Failed: ';
        TAG.TAG008 = 'Select a slot';
        TAG.TAG009 = 'Waiting list';
        
        var $ = jQuery.noConflict();
        $(document).ready(function(){
            getData();
             if(model.mode == 'fb'){
                $('.right-sidebar').addClass('hide');
                $('.leftPanel').removeClass('col-sm-8');
            }
            if(model.serviceId){
                $('#selectedServicePanel').hide();
            }
        });
        
        model.oppurtunityId = "{!JSENCODE($CurrentPage.parameters.bksloppid)}";
        if(model.oppurtunityId != null){
        var src = new SObjectModel.getActs();
        //Use Remote Object to query 5 records
        src.retrieve({
        where : {
        offerOpp :{
        eq : model.oppurtunityId
        }
        }
        } ,
        function(err,records){
        if(err == null)
        {
        console.log(records);
        populate(records);
        //Process returned "records" to display in Visualforce code.
        }else{
        
        }
        } );
        }
       var getContactId;
        function populate(records)
          {
              records.forEach(function(record) {
                   getContactId = record.get("offerCon");
                   var getOpporId = record.get("offerOpp");
                    console.log(getContactId);
                    console.log(getOpporId);
                     model.contactId = getContactId;
                        if(model.contactId != null){
                        var source = new SObjectModel.getCon();
                        source.retrieve({
                        where : {
                        offerConId :{
                        eq : model.contactId
                        }
                        }
                        } ,
                        function(err,records){
                        if(err == null)
                        {
                        getContactDetails(records);
                        }else{

                        }
                        } );
                        }
            var lname;
            var conEmail;
            function getContactDetails(records){
                console.log('getContactDetails'+records);
                records.forEach(function(record) {
                    conEmail = record.get("offeremail");
                    lname = record.get("offerlname");
                    fname = record.get("offerfname");
                    phone = record.get("offerphone");
                    $('#contactLastName').val(lname);
                    $("#contactLastName").attr("disabled", "disabled"); 
                    $('#contactEmail').val(conEmail);
                    $("#contactEmail").attr("disabled", "disabled"); 
                    $('#contactFirtsName').val(fname);
                    $("#contactFirtsName").attr("disabled", "disabled");
                    $('#contactPhone').val(phone);
                    $("#contactPhone").attr("disabled", "disabled"); 
              });
            }
            console.log('getContactId'+model.contactId);
                    //$('#contactInfo').hide();
              });
          }
          
           if(model.oppurtunityId != null){
            var source = new SObjectModel.getUser();
            source.retrieve({
            where : {
            offerOppId :{
            eq : model.oppurtunityId
            }
            }
            } ,
            function(err,records){
            if(err == null)
            {
            getOwnerId(records);
            }else{
            
            }
            } );
            }
            var SRQappOwnerId;
            function getOwnerId(records){
                console.log(records);
                records.forEach(function(record) {
                    SRQappOwnerId = record.get("offerOwner");
                    console.log('getOppOwnerId'+SRQappOwnerId);
                    model.UserId = SRQappOwnerId;
              });
            }
            
        
        
        model.contactId = "{!JSENCODE($CurrentPage.parameters.bkslconid)}";
        model.bkslmode = "{!JSENCODE($CurrentPage.parameters.bkslmode)}";
        
        model.customerId = "{!JSENCODE($CurrentPage.parameters.bkslcustid)}";
        model.serviceId = "{!JSENCODE($CurrentPage.parameters.bkslserid)}";
        model.serviceRequestId = "{!JSENCODE($CurrentPage.parameters.bkslsreqid)}";
        //Assigning dprv as prv  
        model.providerId = '{!JSENCODE($CurrentPage.parameters.dprv)}';
        model.mode = '{!JSENCODE($CurrentPage.parameters.mode)}';
        model.directproviderId = '{!JSENCODE($CurrentPage.parameters.dprv)}';
        model.previousAppointmentDate = null;
        model.gcalEvents = {};
        model.prop = {showOnlyStartTime: false, blockedSlots: 'hide', mode: 'MULTISERVICE', 
                        predefinedDate: "{!JSENCODE($CurrentPage.parameters.dt)}", workingHourDef: 'WORKINGHOUR',
                        waitinglist: true};
        
        model.prop.brandingEnabled = true;
        if(model.mode == 'fb'){
            model.prop.brandingEnabled = false;
        }
        model.prop.webhooks = {
            getBookedSlotDate : function(){
                var d1 = new Date($("#selectedDate").val());
                var month = d1.getMonth() + 1;
                return month + '-' + d1.getDate() + '-' + d1.getFullYear();
            }
        }
        
        /*
        model.prop.webhooks = {
            onBookingAppointment : function(){
            },
            onCancelAppointment : function(){
            },
            getBookedSlotDate : function(){
                return $("#selectedDate").val() + ' ' + $('#availableTimeSlots').val().replace(/[_]/g,' to ')
            }
        }*/
        model.prop.customValidation = function(){
            if(model.bkslmode == 'reSchedule'){
                return LiveValidation.massValidate( [availableTimeSlots_V, selectedDate_V] );
            }
            else {
                return LiveValidation.massValidate( [availableTimeSlots_V, contactFirtsName_V, contactLastName_V, contactEmail_V, selectedDate_V] );
            }
        }
        
        
        model.prop.customAfterServiceSelection = function(){
            //populateSelect('contactPackage', model.serviceId)
        }
        model.prop.customSorting = function(records){
            records.sort(function(a,b){
            if(!a.BKSL2__Available_On__c)
                return 1;
            var c = new Date(a.BKSL2__Available_On__c);
            var d = new Date(b.BKSL2__Available_On__c);
            return c-d;
            });
        }
        //When you click on a link with class of poplight and the href starts with a # 
        function showPopUp(popID, popWidth, isCloseAvailable) {
            //Fade in the Popup and add close button
            $('#' + popID).fadeIn().css({ 'width': Number( popWidth ) }).prepend('');
        
            //Define margin for center alignment (vertical   horizontal) - we add 80px to the height/width to accomodate for the padding  and border width defined in the css
            var popMargTop = ($('#' + popID).height() + 80) / 2;
            var popMargLeft = ($('#' + popID).width() + 80) / 2;
            
            if(isCloseAvailable)
                $('#' + popID).fadeIn().css({ 'width': Number( popWidth ) }).prepend('<a href="#" class="close"><img src="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/BookingScreen/images/closeBtn.png')}" class="btn_close" title="Close" alt="Close" /></a>');
            else
                $('#' + popID).fadeIn().css({ 'width': Number( popWidth ) });
        
            //Apply Margin to Popup
            $('#' + popID).css({
                'margin-top' : -popMargTop,
                'margin-left' : -popMargLeft
            });
        
            //Fade in Background
            $('body').append('<div id="fade"></div>'); //Add the fade layer to bottom of the body tag.
            $('#fade').css({'filter' : 'alpha(opacity=80)'}).fadeIn(); //Fade in the fade layer - .css({'filter' : 'alpha(opacity=80)'}) is used to fix the IE Bug on fading transparencies 
        
            //Close Popups and Fade Layer
            $('a.close').live('click', function() { //When clicking on the close or fade layer...
                $('#fade , .popup_block').fadeOut(function() {
                    $('#fade, a.close').remove();  //fade them both out
                });
                return false;
            });
            return false;
        }
        
        function getContact(){
            /*var objContact = {};
            if(model.contactId)
            {
                if(model.contactId)
                    objContact['id'] = model.contactId;
            }
            objContact['FirstName'] = document.getElementById("contactFirtsName").value;
            objContact['LastName'] = document.getElementById("contactLastName").value;
            objContact['Email'] = document.getElementById("contactEmail").value;
            objContact['Phone'] = document.getElementById("contactPhone").value;
            var response = new BSLMap('Contact', null, null, null, null);
            response.objContact = objContact;
            console.log('conact Id'+response);
            return response;*/
            //Let not to create contact object
            var response = new BSLMap('Contact', 'DONOTCREATECONTACT', null, null, null);
            //response.objContact = objContact;
            return response;
        }
        
        function getServiceRequest(){
            var objServiceRequest = {};
            objServiceRequest['BKSL2__Service__c'] = model.serviceId;
            objServiceRequest['Name'] = model.serviceName;
            if(model.oppurtunityId != ''){
                objServiceRequest['Appointment_Owner__c'] = model.UserId;
                objServiceRequest['Opportunity__c'] = model.oppurtunityId;
            }
            objServiceRequest['Contact_FirstName__c'] = document.getElementById("contactFirtsName").value;
            objServiceRequest['Contact_LastName__c'] = document.getElementById("contactLastName").value;
            objServiceRequest['Contact_Email__c'] = document.getElementById("contactEmail").value;
            objServiceRequest['Contact_Phone__c'] = document.getElementById("contactPhone").value;
            var response = new BSLMap('SERVICEREQUEST', null, null, null, null);
            response.objServiceRequest = objServiceRequest;
            return response;
        }

        function clearContact()
        {
            model.contactId = null;
            delete model.contact;
            $('#existingContact').hide();
        }
        
        //Close Popups and Fade Layer
        function closePopUp() { //When clicking on the close or fade layer...
            $('#fade , .popup_block').fadeOut(function() {
                $('#fade, a.close').remove();  //fade them both out
            });
            return false;
        }
        
        
        function bookOneMoreAppointment(){
            top.location = top.location;
            if(model.contactId){
                if(model.serviceId)
                    top.location = top.location+'&&bkslconid='+model.contactId+'&&bkslserid='+model.serviceId;
                else
                    top.location = top.location+'&&bkslconid='+model.contactId;
            }
        }
        
        function callBKSLinternalEvent(type){
            $('#callEvent').val(type);
            $('#callEvent').click();
        };
        
    </script>
  <body>
<header>
    <div class="container">
        <div class="col-md-6 col-sm-6">
            <div class="row">
                <div class="col-md-1 col-sm-1" style="text-align:center;">
                    <img src="http://markettraders.com/logos/mti-logo-ns_212x74.png" alt="MTI"/>
                </div>

            </div>
        </div>
        <div class="col-md-6 col-sm-6 motto" style="text-align:center;padding-top:25px">
              For Immediate Assistance: <b>1-866-787-8558</b>
        </div>
    </div>
</header>

<div class="page-title">
<div class="container">
<h1><i class="fa fa-clock-o"></i> Schedule Your Appointment</h1>
</div>
<div class="container body-content" id="serviceListing">
<div id="popup_name" class="popup_block"><img class="l-border" style="width: 20px;padding-left: 20px;" alt="" src="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/images/preloader.gif')}"/><span style="padding-left:30px">Loading...</span></div>
<div id="error_popup" class="popup_block"><div id="contactInfoError" class="relativeTimeSelection LV_invalid hide"></div></div>
<div id="bookingscreen1" class="row mainpanel">
<!--<img id="brandheadermobile" src="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/images/Brand-Page-Mobile.png')}" class="visible-xs img-responsive" style="width:100%"/>-->
    <div class="col-md-12 col-sm-12 ">
        <div class="serviceAction" id="selectedServicePanel">
        <!-- <legend id="headerText" style="font-weight:bold"></legend> -->
        <div class="selectedServicePanel">
              <center><div id="selectedServiceDetails"></div> </center>
        </div>
        </div>
        <div id="fieldSet1" class="fieldset border margin-b">
        <div id="selectDateTime" class="row reduce_margin hide">
            <div class="row ">
                <h4><img src="{!URLFOR($Resource.BKSL2__BookingWidget, 'BookingScreen/css/img/2.png')}" alt="Schedule a Date/Time"/> Schedule a Date/Time:</h4>

                <div class="col-xs-12 col-md-6 form-group has-feedback">
                    <p>Choose a date:</p>
                    <i class="form-control-feedback fa fa-calendar fa-2x" style="top: 36px;right: 20px;"></i>
                    <input type="text" name="date" placeholder="Please Select Date" id="selectedDate" class="form-control input-lg">
                    </input>

                </div>
                <div class="col-xs-12 col-md-6">
                    <p>Choose an available time slot:</p>
                    <!--<label  class="col-sm-4 reduce_padding " for="availableTimeSlots">Select a Slot</label>-->
                    <i class="form-control-feedback fa fa-clock-o fa-2x" style="position: absolute; margin-right: 17px;margin-top: 8%;"></i>
                    <select style="line-height: 26px;-webkit-appearance: none;" id="availableTimeSlots" class="form-control input-lg" placeholder="Select Date">
                    </select>
                    
                    
                </div>
            </div>
        </div>
        </div>
        <div id="fieldSet4" class="fieldset border margin-b">
             <input id="callEvent" type="text" style='display:none'/>
                <div id="locationList" class="left-content">
                <h2><img src="{!URLFOR($Resource.BKSL2__BookingWidget, 'BookingScreen/css/img/1.png')}" alt="Choose Appointment Type"/> Choose Appointment Type: </h2>
                <br/>
                <ul class="showServiceDetails"></ul>
                 <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 poweredby">
            <p>You will get to choose your date and time on the next screen.</p>
        <p ><img src="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/images/bookingsocial_24_24.png')}" />
            Powered by Booking Social</p>
    </div>
            </div>
        </div>
        
        <div id="fieldSet2" class="fieldset  border margin-b">
           <div id="contactInfo" class="row reduce_margin hide left-content">
                    <div class="row">
                    <h4><img src="{!URLFOR($Resource.BKSL2__BookingWidget, 'BookingScreen/css/img/3.png')}" alt="Add Your Contact Information"/> Add Your Contact Information:</h4>

                    <div class="col-xs-12 col-md-6">
                    <p>First Name</p>
                    <input type="text" name="firstname" value=""  id="contactFirtsName" class="form-control input-lg"/>
                    </div>
                    <div class="col-xs-12 col-md-6">
                    <p>Last Name</p>
                    <input type="text" name="lastname" value="" id="contactLastName" class="form-control input-lg"/>
                    </div>
                    </div><br/>
                    <div class="row">
                    <div class="col-xs-12 col-md-6">
                    <p>Email Address:</p>
                    <input type="text" name="email" value="" id="contactEmail" class="form-control input-lg"/>
                    </div>
                    <div class="col-xs-12 col-md-6">
                    <p>Phone Number:</p>
                    <input type="text" name="phone" value="" id="contactPhone" class="form-control input-lg"/>
                    </div>
                    </div>
                    <br/>
            </div>
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 privacy-note hide" id="bookingBtn" style="text-align:center;">
                    <p><i class="fa fa-lock"></i> <b>Your privacy is important to us.</b>  The information above will only be used in regard to your appointment.</p>
                    <button class="button" role="div" id="bookAppointment" style="width:300px;margin:0 auto!important;border:none;">Schedule This Appointment</button>    
                </div>
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 poweredby hide" id="bookingScrren">
                    <p ><img src="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/images/bookingsocial_24_24.png')}" />Powered by Booking Social</p>
                </div>
        </div>
        <div id="fieldSet3" class="fieldset border margin-b">
            <div id="bookedInfo">
                <ul Id="elBookedInfo" class="hide"></ul>
            </div>
        </div>
    </div>
    
</div>
</div>
</div>
<div class="row"><div class="col-md-4"></div><footer>
    <div class="container">
       <p>Copyright © 2015 Market Traders Institute, Inc. All Rights Reserved.</p>
                    
                    <p>Our address is 400 Colonial Center Parkway, Suite 350, Lake Mary, Florida, 32746, United States of America</p>

    </div>
</footer></div>
<script>
    var availableTimeSlots_V = new LiveValidation( "availableTimeSlots", { wait: 500, onlyOnSubmit: true , validMessage : ' ' } );
    availableTimeSlots_V.add( Validate.Presence,{ failureMessage: "Select available slot."} );
    
    var selectedDate_V = new LiveValidation( "selectedDate", { wait: 500, onlyOnSubmit: true , validMessage : ' ' } );
    selectedDate_V.add( Validate.Presence,{ failureMessage: "Select a valid date." } );
    var contactFirtsName_V = new LiveValidation( "contactFirtsName", { wait: 500, onlyOnSubmit: true , validMessage : ' ' } );
    //contactFirtsName.add( Validate.Presence,{ failureMessage: "This field is required." } );
    var contactLastName_V = new LiveValidation( "contactLastName", { wait: 500, onlyOnSubmit: true , validMessage : ' ' } );
    contactLastName_V.add( Validate.Presence,{ failureMessage: "Your last name is required." } );
    var contactEmail_V = new LiveValidation( "contactEmail", { wait: 500, onlyOnSubmit: true , validMessage : ' ' } );
    contactEmail_V.add( Validate.Presence,{ failureMessage: "Your email is required." } );
    contactEmail_V.add( Validate.Email,{validMessage : ' '} );
    //var contactPhone_V = new LiveValidation( "contactPhone", { wait: 500, onlyOnSubmit: true } );
    //contactPhone_V.add( Validate.Presence,{ failureMessage: "Your contact number is required." } );
    showPopUp("popup_name", 300, false);
        $('#bookAppointment').click(function() {
            var slots = $('#availableTimeSlots').val();
            var res = slots.replace("-", " to ");
            model.slots = res;
            
        });
        if(model.bkslmode == 'reSchedule'){
            $('#contactInfo').hide();
        } else{
            $('#contactInfo').show();
        }  
        
</script>
<apex:includeScript value="{!URLFOR($Resource.BKSL2__BookingSocial_Library, 'BookingSocial_Library/js.lib/respond.js')}"/>
</body>
</apex:page>